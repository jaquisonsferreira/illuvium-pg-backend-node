FROM node:22-slim

WORKDIR /app

COPY package.json ./

# Garantir que todas as dependências sejam instaladas (incluindo devDependencies)
ENV NODE_ENV=development

# Instalar @nestjs/cli globalmente para garantir que o comando nest esteja disponível
RUN npm install -g @nestjs/cli

# Limpar cache do npm e instalar as dependências do projeto
RUN npm cache clean --force && npm install --legacy-peer-deps

COPY . .

# Adicionar node_modules/.bin ao PATH
ENV PATH="/app/node_modules/.bin:${PATH}"

EXPOSE 5000

CMD ["npm", "run", "start:dev"]